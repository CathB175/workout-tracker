<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #f9fafb; }
        .header { background: #14b8a6; color: white; padding: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header h1 { font-size: 20px; text-align: center; }
        .back-btn { background: none; border: none; color: white; font-size: 16px; cursor: pointer; float: left; }
        .container { padding: 24px 24px 100px 24px; }
        .title { font-size: 28px; font-weight: bold; margin-bottom: 8px; }
        .subtitle { color: #6b7280; margin-bottom: 32px; font-size: 14px; }
        .weekly-summary { background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%); color: white; padding: 16px; border-radius: 12px; margin-bottom: 24px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .weekly-summary .big { font-size: 32px; font-weight: bold; margin-bottom: 4px; }
        .weekly-summary .small { font-size: 14px; opacity: 0.9; }
        .affirmation-card { background: linear-gradient(135deg, #f0fdfa 0%, #ccfbf1 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 2px solid #14b8a6; position: relative; }
        .affirmation-text { font-size: 16px; line-height: 1.6; color: #0f766e; font-style: italic; text-align: center; margin-bottom: 12px; font-weight: 500; }
        .affirmation-actions { display: flex; justify-content: center; gap: 16px; align-items: center; }
        .affirmation-btn { background: none; border: none; font-size: 24px; cursor: pointer; padding: 8px; }
        .affirmation-heart { color: #d1d5db; }
        .affirmation-heart.active { color: #f43f5e; }
        .affirmation-next { color: #14b8a6; font-size: 14px; font-weight: 600; }
        .goal-badge { position: absolute; top: 12px; right: 44px; font-size: 11px; font-weight: 600; padding: 4px 8px; border-radius: 4px; }
        .goal-badge.complete { background: #14b8a6; color: white; }
        .goal-badge.partial { background: #14b8a6; color: white; }
        .goal-badge.pending { background: #e5e7eb; color: #6b7280; }
        .card { background: white; padding: 16px; border-radius: 8px; border: 2px solid #f3f4f6; margin-bottom: 12px; cursor: pointer; position: relative; }
        .card:active { background: #f9fafb; }
        .card.completed { background: #ccfbf1; border-color: #14b8a6; }
        .card.partial { background: #ccfbf1; border-color: #14b8a6; }
        .card h3 { font-weight: 600; font-size: 18px; margin-bottom: 4px; }
        .card p { font-size: 14px; color: #6b7280; margin-bottom: 4px; }
        .card small { font-size: 12px; color: #6b7280; display: block; margin-top: 4px; }
        .card .equipment { font-size: 13px; color: #14b8a6; margin-top: 6px; font-weight: 500; }
        .empty-state { text-align: center; color: #9ca3af; padding: 40px 20px; font-size: 15px; }
        .nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #e5e7eb; display: flex; }
        .nav button { flex: 1; padding: 16px; background: none; border: none; color: #9ca3af; font-size: 12px; cursor: pointer; }
        .nav button.active { color: #14b8a6; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.75); padding: 20px; overflow-y: auto; z-index: 9999; }
        .modal.show { display: block; }
        .modal-content { background: white; margin: 20px auto; padding: 24px; border-radius: 12px; max-width: 400px; }
        .modal h3 { font-size: 22px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #eee; }
        .workout-details { background: #f9fafb; padding: 12px; border-radius: 8px; margin-bottom: 16px; font-size: 14px; }
        .workout-details strong { display: block; margin-bottom: 4px; color: #111; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 6px; font-size: 14px; }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; font-family: inherit; }
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        .btn { flex: 1; padding: 14px; border: none; border-radius: 8px; font-weight: 600; font-size: 16px; cursor: pointer; }
        .btn-cancel { background: #e5e7eb; color: #111; }
        .btn-save { background: #14b8a6; color: white; }
        .hidden { display: none; }
        .history-card { background: white; padding: 14px; border-radius: 8px; border: 2px solid #f3f4f6; margin-bottom: 10px; }
        .history-card h4 { font-size: 16px; font-weight: 600; margin-bottom: 6px; }
        .history-card .meta { font-size: 12px; color: #6b7280; margin-bottom: 8px; }
        .history-card .notes { font-size: 14px; color: #374151; font-style: italic; background: #f9fafb; padding: 8px; border-radius: 6px; margin-top: 8px; }
        .badge { display: inline-block; background: #dbeafe; color: #1e40af; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; margin-top: 4px; }
        .workout-group { border: 2px solid #14b8a6; border-radius: 8px; padding: 12px; margin-bottom: 16px; background: #f0fdfa; }
        .workout-group-title { font-size: 13px; font-weight: 600; color: #0f766e; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
        .favorite-star { position: absolute; top: 12px; right: 12px; font-size: 20px; cursor: pointer; z-index: 10; }
        .favorite-star.active { color: #f59e0b; }
        .favorite-star.inactive { color: #d1d5db; }
    </style>
</head>
<body>
    <div class="header">
        <button class="back-btn hidden" id="backBtn" onclick="goBack()">‚Üê Back</button>
        <h1>Workout Tracker</h1>
    </div>

    <div class="container" id="homeView">
        <h1 class="title">What do you fancy doing?</h1>
        <p class="subtitle">Choose your workout type</p>
        <div id="typesList"></div>
    </div>

    <div class="container hidden" id="cyclesView">
        <h2 class="title" id="cyclesTitle"></h2>
        <p class="subtitle" id="cyclesSubtitle"></p>
        <div id="cyclesList"></div>
    </div>

    <div class="container hidden" id="sessionsView">
        <h2 class="title" id="sessionsTitle"></h2>
        <p class="subtitle">Choose a session</p>
        <div id="sessionsList"></div>
    </div>

    <div class="container hidden" id="workoutsView">
        <h2 class="title" id="workoutsTitle"></h2>
        <p class="subtitle" id="workoutsSubtitle"></p>
        <div id="workoutsList"></div>
    </div>

    <div class="container hidden" id="historyView">
        <h2 class="title">Workout History</h2>
        <div id="historyList"></div>
    </div>

    <div class="modal" id="logModal">
        <div class="modal-content">
            <h3>Log Workout</h3>
            <div class="workout-details" id="workoutDetails"></div>
            <div class="form-group">
                <label>Date</label>
                <input type="date" id="logDate">
            </div>
            <div class="form-group">
                <label>Equipment Used</label>
                <input type="text" id="logEquipment" placeholder="Dumbbells, resistance band, etc.">
            </div>
            <div class="form-group">
                <label>Notes</label>
                <textarea id="logNotes" rows="3" placeholder="Weights used, how it felt, modifications..."></textarea>
            </div>
            <div class="btn-group">
                <button class="btn btn-cancel" onclick="closeModal()">Cancel</button>
                <button class="btn btn-save" onclick="saveWorkout()">Save</button>
            </div>
        </div>
    </div>

    <div class="nav">
        <button id="homeNavBtn" class="active" onclick="showHome()">
            <div>üè†</div>
            Home
        </button>
        <button id="historyNavBtn" onclick="showHistory()">
            <div>üìã</div>
            History
        </button>
    </div>

    <script>
        let currentView = 'home';
        let selectedType = null;
        let selectedCycle = null;
        let selectedWorkout = null;
        let history = [];
        let favorites = JSON.parse(localStorage.getItem('workoutFavorites') || '[]');
        let favoriteAffirmations = JSON.parse(localStorage.getItem('favoriteAffirmations') || '[]');
        let dailyAffirmationIndex = 0;

        // Load and clean history on startup
        (function initHistory() {
            const saved = localStorage.getItem('workoutHistory');
            if (saved) {
                const allHistory = JSON.parse(saved);
                const threeMonthsAgo = new Date();
                threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);
                history = allHistory.filter(h => new Date(h.date) >= threeMonthsAgo);
                if (history.length !== allHistory.length) {
                    localStorage.setItem('workoutHistory', JSON.stringify(history));
                }
            }
        })();

        const affirmations = [
            "You are stronger than you think, both in body and mind.",
            "Every movement is progress, no matter how small.",
            "Your body is capable of amazing things today.",
            "Rest is part of the journey, not a pause from it.",
            "You are worthy of the time you invest in yourself.",
            "This phase of life brings wisdom and strength.",
            "Listen to your body - it knows what it needs.",
            "Your consistency matters more than perfection.",
            "You are creating a life of vitality and joy.",
            "Breathe deeply. You are exactly where you need to be.",
            "Your strength grows from showing up, again and again.",
            "You are evolving beautifully through every season of life.",
            "Movement is a celebration of what your body can do.",
            "Today, you choose to honor your wellbeing.",
            "You deserve the same kindness you give to others.",
            "Your body is your home - treat it with love.",
            "Small steps still move you forward.",
            "You are enough, exactly as you are right now.",
            "This moment is an opportunity for growth.",
            "Your journey is uniquely yours - honor it.",
            "Strength isn't just physical, it's showing up with courage.",
            "You are building habits that will serve you for life.",
            "Every breath is a chance to begin again.",
            "Your resilience is remarkable.",
            "You are worthy of rest, recovery, and renewal."
        ];

        const types = [
            { id: 'hiit', name: 'HIIT', description: 'High-Intensity Interval Training from The Body Coach', hasCycles: true, weeklyGoal: 1 },
            { id: 'strength', name: 'Strength in Menopause', description: 'Building strength and stability with The Body Coach', weeklyGoal: 1 },
            { id: 'barre', name: 'Barre', description: 'Define strength and lengthen with The Body Coach', weeklyGoal: 1 },
            { id: 'yoga-pilates', name: 'Yoga & Pilates', description: 'Flow and strengthen with The Body Coach', weeklyGoal: 1 },
            { id: 'smm', name: 'SMM', description: 'Simple Mobility Method for daily movements', weeklyGoal: 1 },
            { id: 'stability', name: 'Stability Builder', description: 'Build a solid core foundation and improve balance', weeklyGoal: 1 },
            { id: 'spf', name: 'SPF', description: 'Keeping your shoulders neck and upper back happy', weeklyGoal: 4 }
        ];

        const data = {
            hiit: {
                cycles: [
                    { 
                        id: 1, 
                        name: 'Cycle 1', 
                        workouts: [
                            { session: 1, name: 'Cycle 1 - Workout 1', info: 'HIIT 5 moves x 5 rounds 30s work 30s rest', duration: 25, equipment: '', notes: '' },
                            { session: 2, name: 'Cycle 1 - Workout 2', info: 'HIIT 5 moves x 5 rounds 30s work 30s rest', duration: 25, equipment: '', notes: '' },
                            { session: 3, name: 'Cycle 1 - Workout 3', info: 'HIIT 6 moves x 4 rounds 30s work 30s rest', duration: 25, equipment: '', notes: '' },
                            { session: 4, name: 'Cycle 1 - Workout 4', info: 'HIIT 8 moves x 3 rounds 30s work 30s rest', duration: 25, equipment: '', notes: '' },
                            { session: 5, name: 'Cycle 1 - Workout 5', info: 'HIIT 12 moves x 2 rounds 30s work 30s rest', duration: 25, equipment: '', notes: '' }
                        ]
                    },
                    { 
                        id: 2, 
                        name: 'Cycle 2', 
                        workouts: [
                            { session: 1, name: 'Cycle 2 - Workout 1', info: 'HIIT 10 moves x 3 rounds 30s work 30s rest', duration: 30, equipment: '', notes: '' },
                            { session: 2, name: 'Cycle 2 - Workout 2', info: 'Cardio & Abs HIIT 10 moves x 3 rounds 30s work 30s rest', duration: 30, equipment: '', notes: '' },
                            { session: 3, name: 'Cycle 2 - Workout 3', info: 'HIIT 15 moves x 2 rounds 30s work 30s rest', duration: 30, equipment: '', notes: '' },
                            { session: 4, name: 'Cycle 2 - Workout 4', info: 'HIIT 5 moves x 6 rounds 30s work 30s rest', duration: 30, equipment: '', notes: '' },
                            { session: 5, name: 'Cycle 2 - Workout 5', info: 'HIIT 7 moves x 4 rounds 30s work 30s rest', duration: 30, equipment: '', notes: '' }
                        ]
                    },
                    { 
                        id: 3, 
                        name: 'Cycle 3', 
                        workouts: [
                            { session: 1, name: 'Cycle 3 - Workout 1', info: 'HIIT 10 moves x 3 rounds 35s work 25s rest', duration: 30, equipment: '', notes: '' },
                            { session: 2, name: 'Cycle 3 - Workout 2', info: 'Lower Body 5 moves x 2 rounds - Upper Body 5 moves x 2 rounds 35s work 25s rest', duration: 30, equipment: '', notes: '' },
                            { session: 3, name: 'Cycle 3 - Workout 3', info: 'HIIT 8 moves x 3 rounds 35s work 25s rest - Abs circuit 5 moves x 1 round 30s work 30s rest', duration: 30, equipment: '', notes: '' },
                            { session: 4, name: 'Cycle 3 - Workout 4', info: 'Lower Body 5 moves x 2 rounds - Upper Body 5 moves x 2 rounds 30s work 30s rest - Cardio 5 moves x 2 rounds 30s work 30s rest', duration: 30, equipment: '', notes: '' },
                            { session: 5, name: 'Cycle 3 - Workout 5', info: 'HIIT 15 moves x 2 rounds 35s work 25s rest then 40s work 20s rest', duration: 30, equipment: '', notes: '' }
                        ]
                    }
                ]
            },
            strength: [
                { id: 'menopause_ub1', name: 'Upper Body 1', info: 'Upper Body 5 moves x 4 rounds 40s work 20s rest', duration: 20, equipment: 'Weights', notes: '' },
                { id: 'menopause_lb1', name: 'Lower Body 1', info: 'Lower Body 5 moves x 4 rounds 40s work 20s rest', duration: 20, equipment: 'Weights', notes: '' },
                { id: 'menopause_ub2', name: 'Upper Body 2', info: 'Upper Body 5 moves x 4 rounds 40s work 20s rest', duration: 20, equipment: 'Weights', notes: '' },
                { id: 'menopause_lb2', name: 'Lower Body 2', info: 'Lower Body 5 moves x 4 rounds 40s work 20s rest', duration: 20, equipment: 'Weights', notes: '' },
                { id: 'menopause_fb1', name: 'Full Body 1', info: 'Full Body 10 moves x 2 rounds 40s work 20s rest', duration: 20, equipment: 'Weights', notes: '' },
                { id: 'menopause_fb2', name: 'Full Body 2', info: 'Full Body 10 moves x 2 rounds 40s work 20s rest', duration: 20, equipment: 'Weights', notes: '' },
                { id: 'strength_1', name: 'Strength 1', info: 'Workout 1 5 moves x 2 rounds 30s work 30s rest', duration: 10, equipment: 'Resistance band', notes: '' },
                { id: 'strength_2', name: 'Strength 2', info: 'Workout 2 5 moves x 2 rounds 30s work 30s rest', duration: 10, equipment: 'Resistance band', notes: '' },
                { id: 'strength_3', name: 'Strength 3', info: 'Workout 3 7 moves x 2 rounds 30s work 30s rest', duration: 15, equipment: 'Resistance band', notes: '' },
                { id: 'strength_4', name: 'Strength 4', info: 'Workout 4 7 moves x 2 rounds 30s work 30s rest', duration: 15, equipment: 'Resistance band', notes: '' },
                { id: 'strength_5', name: 'Strength 5', info: 'Workout 5 7 moves x 2 rounds 35s work 25s rest', duration: 15, equipment: 'Resistance band', notes: '' },
                { id: 'strength_6', name: 'Strength 6', info: 'Workout 6 7 moves x 2 rounds 35s work 25s rest', duration: 15, equipment: 'Resistance band', notes: '' },
                { id: 'strength_7', name: 'Strength 7', info: 'Workout 7 10 moves x 2 rounds 35s work 25s rest', duration: 20, equipment: 'Resistance band', notes: '' },
                { id: 'strength_8', name: 'Strength 8', info: 'Workout 8 10 moves x 2 rounds 40s work 20s rest', duration: 20, equipment: 'Resistance band', notes: '' },
                { id: 'strength_9', name: 'Strength 9', info: 'Workout 9 10 moves x 2 rounds 40s work 20s rest', duration: 20, equipment: 'Resistance band', notes: '' },
                { id: 'strength_10', name: 'Strength 10', info: 'Workout 10 10 moves x 2 rounds 40s work 20s rest', duration: 20, equipment: 'Resistance band', notes: '' }
            ],
            barre: [
                { id: 'barre_1', name: 'Weighted Barre', info: 'Leroy weighted barre', duration: 20, equipment: 'Chair and weights', notes: '2 June 22' },
                { id: 'barre_2', name: 'Strengthening Barre', info: 'Leroy strengthening barre', duration: 20, equipment: 'Chair', notes: '2 June 22' },
                { id: 'barre_3', name: 'Energising Barre', info: 'Leroy energising barre', duration: 20, equipment: 'Chair', notes: '2 June 22' },
                { id: 'barre_4', name: 'Dumbbell Sculpt', info: 'Leroy dumbbell sculpt', duration: 20, equipment: 'Weights', notes: '2 June 22' },
                { id: 'barre_5', name: 'Bodyweight Strength', info: 'Leroy bodyweight strength', duration: 20, equipment: 'Chair', notes: '2 June 22' }
            ],
            'yoga-pilates': [
                { id: 'pilates_1', name: 'Fundamental', info: 'Pilates 1 fundamental', duration: 30, equipment: '', notes: '' },
                { id: 'pilates_2', name: 'Core Stability', info: 'Pilates 2 core stability', duration: 25, equipment: '', notes: '' },
                { id: 'pilates_3', name: 'Healthy Spine', info: 'Pilates 3 health spine', duration: 30, equipment: '', notes: '' },
                { id: 'pilates_4', name: 'Flexibility', info: 'Pilates 4 flexibility', duration: 25, equipment: '', notes: '' },
                { id: 'pilates_5', name: 'Standing', info: 'Pilates 5 standing', duration: 20, equipment: '', notes: '' },
                { id: 'pilates_6', name: 'Total Body Flow', info: 'Pilates 6 Total body flow', duration: 30, equipment: '', notes: '' },
                { id: 'sunday_stretch_1', name: 'Sunday Stretch 7/3', info: 'Sunday stretch with Joe', duration: 30, equipment: '', notes: '' },
                { id: 'sunday_stretch_2', name: 'Sunday Stretch 14/3', info: 'Sunday stretch with Joe', duration: 30, equipment: '', notes: '' },
                { id: 'sunday_stretch_3', name: 'Sunday Stretch 21/3', info: 'Sunday stretch with Joe', duration: 30, equipment: '', notes: '' },
                { id: 'sunday_stretch_4', name: 'Sunday Stretch 28/3', info: 'Sunday stretch with Joe', duration: 30, equipment: '', notes: '' },
                { id: 'sunday_stretch_5', name: 'Sunday Stretch 4/4', info: 'Sunday stretch with Joe', duration: 30, equipment: '', notes: '' },
                { id: 'sunday_stretch_6', name: 'Sunday Stretch 11/4', info: 'Sunday stretch with Joe', duration: 30, equipment: '', notes: '' },
                { id: 'sunday_stretch_7', name: 'Sunday Stretch 18/4', info: 'Sunday stretch with Joe', duration: 30, equipment: '', notes: '' },
                { id: 'sunday_stretch_8', name: 'Sunday Stretch 25/4', info: 'Sunday stretch with Joe', duration: 30, equipment: '', notes: '' },
                { id: 'yoga_1', name: 'Other Yoga', info: 'Other yoga sessions', duration: 30, equipment: '', notes: '' }
            ],
            smm: [
                { id: 'smm_1', name: 'SMM Run through', info: 'Essential daily movements from SMM', duration: 30, equipment: '', notes: '' },
                { id: 'smm_2', name: 'Regression SMM', info: 'Not feeling up to the full SMM', duration: 38, equipment: '', notes: '' },
                { id: 'smm_3', name: 'Super Regression SMM', info: 'Back aching or hips tight do super regression', duration: 25, equipment: '', notes: '' },
                { id: 'smm_4', name: 'SMM Tests', info: 'Test your progress every 4 weeks', duration: 22, equipment: '', notes: '' }
            ],
            stability: [
                { id: 'smm_stability_1', name: 'Isometric Tension', info: 'Progressively ramp up your tension and find the right muscles', duration: 17, equipment: '', notes: 'Cool down finisher' },
                { id: 'smm_stability_2', name: 'Rotation & Balance', info: 'Covers all the ways your spine needs to move', duration: 15, equipment: '', notes: 'Warm up' },
                { id: 'smm_stability_3', name: 'Toebility & Ankles', info: 'Your feet are the foundation', duration: 25, equipment: 'Book or step plate', notes: '' },
                { id: 'smm_stability_4', name: 'Coordination & Plyometrics', info: 'Learn how to absorb your own force', duration: 22, equipment: '', notes: 'Warm up' },
                { id: 'smm_stability_5', name: 'Freestanding Resistance Band', info: 'Improve your stability and muscular endurance', duration: 24, equipment: 'Resistance band', notes: 'Cool down finisher' },
                { id: 'smm_stability_6', name: 'Attached Resistance Band', info: 'Full body and core activation', duration: 27, equipment: 'Resistance band', notes: '' },
                { id: 'smm_stability_7', name: 'Unilateral Stability', info: 'Assessing your workout where do you struggle the most', duration: 22, equipment: 'Weights', notes: 'Cool down finisher' },
                { id: 'smm_stability_8', name: 'Super Duper Sets', info: 'Combining multiple complimentary exercises to increase the workload', duration: 36, equipment: 'Weights', notes: '' },
                { id: 'smm_stability_9', name: 'Lower Back & Core Builder', info: 'Addressing hips core and balance this can be done even during a flareup. No need to warm up first. Resistance band needs attaching so garage used at the end of the workout', duration: 30, equipment: 'Resistance band', notes: '' }
            ],
            spf: [
                { id: 'smm_spf_1', name: 'Daily Circuit 1', info: 'Foundation circuit use as a warm up or posture pick me up', duration: 10, equipment: '', notes: '' },
                { id: 'smm_spf_2', name: 'Daily Circuit 2', info: 'Additional resistance to help progress', duration: 10, equipment: 'Resistance band', notes: '' },
                { id: 'smm_spf_3', name: 'Muscle Activation Circuit', info: 'Muscle activation circuit', duration: 10, equipment: '', notes: '' }
            ]
        };

        function getDailyAffirmation() {
            const today = new Date().toDateString();
            const saved = localStorage.getItem('dailyAffirmationDate');
            
            if (saved !== today) {
                // New day, pick a random affirmation
                dailyAffirmationIndex = Math.floor(Math.random() * affirmations.length);
                localStorage.setItem('dailyAffirmationDate', today);
                localStorage.setItem('dailyAffirmationIndex', dailyAffirmationIndex);
            } else {
                // Same day, use saved index
                dailyAffirmationIndex = parseInt(localStorage.getItem('dailyAffirmationIndex') || '0');
            }
            
            return affirmations[dailyAffirmationIndex];
        }

        function nextAffirmation() {
            dailyAffirmationIndex = (dailyAffirmationIndex + 1) % affirmations.length;
            localStorage.setItem('dailyAffirmationIndex', dailyAffirmationIndex);
            renderTypes();
        }

        function toggleAffirmationFavorite() {
            const affirmation = affirmations[dailyAffirmationIndex];
            const index = favoriteAffirmations.indexOf(affirmation);
            
            if (index > -1) {
                favoriteAffirmations.splice(index, 1);
            } else {
                favoriteAffirmations.push(affirmation);
            }
            
            localStorage.setItem('favoriteAffirmations', JSON.stringify(favoriteAffirmations));
            renderTypes();
        }

        function isAffirmationFavorite() {
            return favoriteAffirmations.includes(affirmations[dailyAffirmationIndex]);
        }

        function toggleFavorite(workoutId, event) {
            event.stopPropagation();
            const index = favorites.indexOf(workoutId);
            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(workoutId);
            }
            localStorage.setItem('workoutFavorites', JSON.stringify(favorites));
            if (currentView === 'workouts') showWorkouts();
            else if (currentView === 'sessions') showSessions();
        }

        function isFavorite(workoutId) {
            return favorites.includes(workoutId);
        }

        function getWeekStart() {
            const now = new Date();
            const day = now.getDay();
            const diff = now.getDate() - day + (day === 0 ? -6 : 1);
            const monday = new Date(now.setDate(diff));
            monday.setHours(0, 0, 0, 0);
            return monday;
        }

        function getThisWeeksWorkouts(typeId) {
            const weekStart = getWeekStart();
            return history.filter(h => {
                const workoutDate = new Date(h.date);
                return h.type === typeId && workoutDate >= weekStart;
            });
        }

        function getWeeklyProgress() {
            let completed = 0;
            let total = 0;
            types.forEach(type => {
                const thisWeek = getThisWeeksWorkouts(type.id).length;
                const goal = type.weeklyGoal;
                total += goal;
                completed += Math.min(thisWeek, goal);
            });
            return { completed, total };
        }

        function getLast(type, cycle = null, session = null) {
            return history.filter(h => {
                if (h.type !== type) return false;
                if (cycle && h.cycle !== cycle) return false;
                if (session && h.session !== session) return false;
                return true;
            }).sort((a,b) => new Date(b.date) - new Date(a.date))[0];
        }

        function getNext(type) {
            const last = getLast(type);
            if (!last) return { cycle: 1, session: 1 };
            if (last.session < 5) return { cycle: last.cycle, session: last.session + 1 };
            if (last.cycle < 3) return { cycle: last.cycle + 1, session: 1 };
            return { cycle: 1, session: 1 };
        }

        function hideAll() {
            document.querySelectorAll('.container').forEach(el => el.classList.add('hidden'));
            document.getElementById('backBtn').classList.add('hidden');
        }

        function showHome() {
            hideAll();
            currentView = 'home';
            selectedType = null;
            selectedCycle = null;
            selectedWorkout = null;
            document.getElementById('homeView').classList.remove('hidden');
            document.getElementById('homeNavBtn').classList.add('active');
            document.getElementById('historyNavBtn').classList.remove('active');
            renderTypes();
        }

        function renderTypes() {
            const progress = getWeeklyProgress();
            const affirmation = getDailyAffirmation();
            const isFav = isAffirmationFavorite();
            const list = document.getElementById('typesList');
            
            let affirmationHtml = `<div class="affirmation-card">
                <div class="affirmation-text">"${affirmation}"</div>
                <div class="affirmation-actions">
                    <button class="affirmation-btn affirmation-heart ${isFav ? 'active' : ''}" onclick="toggleAffirmationFavorite()">
                        ${isFav ? '‚ù§Ô∏è' : 'ü§ç'}
                    </button>
                    <button class="affirmation-btn affirmation-next" onclick="nextAffirmation()">
                        See another ‚Üí
                    </button>
                </div>
            </div>`;
            
            let summaryHtml = `<div class="weekly-summary">
                <div class="big">${progress.completed} of ${progress.total}</div>
                <div class="small">Weekly workouts completed</div>
            </div>`;
            
            list.innerHTML = affirmationHtml + summaryHtml + types.map(type => {
                const last = getLast(type.id);
                const thisWeek = getThisWeeksWorkouts(type.id).length;
                const goal = type.weeklyGoal;
                const next = type.id === 'hiit' ? getNext(type.id) : null;
                
                let cardClass = 'card';
                let badgeClass = 'goal-badge pending';
                let badgeText = `0/${goal}`;
                
                if (thisWeek >= goal) {
                    cardClass = 'card completed';
                    badgeClass = 'goal-badge complete';
                    badgeText = '‚úì Done';
                } else if (thisWeek > 0) {
                    cardClass = 'card partial';
                    badgeClass = 'goal-badge partial';
                    badgeText = `${thisWeek}/${goal}`;
                }
                
                let lastText = '';
                if (last) {
                    lastText = `<small>Last: ${new Date(last.date).toLocaleDateString()}`;
                    if (last.cycle) lastText += ` - Cycle ${last.cycle} Session ${last.session}`;
                    lastText += '</small>';
                }
                let nextText = '';
                if (next) nextText = `<small style="color: #14b8a6;">Next: Cycle ${next.cycle} Session ${next.session}</small>`;
                
                return `<div class="${cardClass}" onclick="selectType('${type.id}')">
                    <div class="${badgeClass}">${badgeText}</div>
                    <h3>${type.name}</h3>
                    ${lastText}${nextText}
                </div>`;
            }).join('');
        }

        function selectType(typeId) {
            selectedType = types.find(t => t.id === typeId);
            if (selectedType.hasCycles) {
                showCycles();
            } else {
                showWorkouts();
            }
        }

        function showCycles() {
            hideAll();
            currentView = 'cycles';
            document.getElementById('cyclesView').classList.remove('hidden');
            document.getElementById('backBtn').classList.remove('hidden');
            document.getElementById('cyclesTitle').textContent = selectedType.name;
            document.getElementById('cyclesSubtitle').textContent = selectedType.description;
            
            const next = getNext(selectedType.id);
            
            const list = document.getElementById('cyclesList');
            list.innerHTML = `<div style="margin-bottom: 20px; padding: 12px; background: #f0fdfa; border-radius: 8px; border-left: 4px solid #14b8a6;">
                <div style="font-size: 14px; font-weight: 600; color: #0f766e; margin-bottom: 4px;">Next up:</div>
                <div style="font-size: 13px; color: #134e4a;">Cycle ${next.cycle} Session ${next.session}</div>
            </div>` + data.hiit.cycles.map(cycle => {
                const last = getLast(selectedType.id, cycle.id);
                let lastText = '';
                if (last) lastText = `<small>Last: Session ${last.session} - ${new Date(last.date).toLocaleDateString()}</small>`;
                return `<div class="card" onclick="selectCycle(${cycle.id})">
                    <h3>${cycle.name}</h3>
                    <p>5 sessions</p>
                    ${lastText}
                </div>`;
            }).join('');
        }

        function selectCycle(cycleId) {
            selectedCycle = cycleId;
            showSessions();
        }

        function showSessions() {
            hideAll();
            currentView = 'sessions';
            document.getElementById('sessionsView').classList.remove('hidden');
            document.getElementById('backBtn').classList.remove('hidden');
            document.getElementById('sessionsTitle').textContent = `Cycle ${selectedCycle}`;
            
            const list = document.getElementById('sessionsList');
            const cycle = data.hiit.cycles.find(c => c.id === selectedCycle);
            list.innerHTML = cycle.workouts.map(workout => {
                const workoutId = `hiit-${selectedCycle}-${workout.session}`;
                const last = getLast(selectedType.id, selectedCycle, workout.session);
                const favStar = isFavorite(workoutId) ? 'active' : 'inactive';
                let lastText = '';
                if (last) {
                    lastText = `<small>Last: ${new Date(last.date).toLocaleDateString()}</small>`;
                }
                return `<div class="card" onclick='selectSessionWorkout(${JSON.stringify(workout)})'>
                    <span class="favorite-star ${favStar}" onclick='toggleFavorite("${workoutId}", event)'>‚òÖ</span>
                    <div class="goal-badge pending">${workout.duration}m</div>
                    <h3>Session ${workout.session}</h3>
                    <p>${workout.info}</p>
                    ${workout.equipment ? `<div class="equipment">Equipment: ${workout.equipment}</div>` : ''}
                    ${workout.notes ? `<div class="badge">Tip: ${workout.notes}</div>` : ''}
                    ${lastText}
                </div>`;
            }).join('');
        }

        function selectSessionWorkout(workout) {
            selectedWorkout = workout;
            openModal();
        }

        function showWorkouts() {
            hideAll();
            currentView = 'workouts';
            document.getElementById('workoutsView').classList.remove('hidden');
            document.getElementById('backBtn').classList.remove('hidden');
            document.getElementById('workoutsTitle').textContent = selectedType.name;
            document.getElementById('workoutsSubtitle').textContent = selectedType.description;
            
            const list = document.getElementById('workoutsList');
            const workouts = data[selectedType.id];
            
            if (!workouts || workouts.length === 0) {
                list.innerHTML = '<div class="empty-state">No workouts added yet.<br>Add your workouts here when ready!</div>';
            } else {
                // Group strength workouts
                let html = '';
                if (selectedType.id === 'strength') {
                    const bodyWorkouts = workouts.filter(w => w.id.startsWith('menopause_'));
                    const strengthWorkouts = workouts.filter(w => w.id.startsWith('strength_'));
                    
                    html += '<div class="workout-group"><div class="workout-group-title">Body Focus Series</div>';
                    html += bodyWorkouts.map(w => renderWorkoutCard(w)).join('');
                    html += '</div>';
                    
                    html += '<div class="workout-group"><div class="workout-group-title">Strength Series</div>';
                    html += strengthWorkouts.map(w => renderWorkoutCard(w)).join('');
                    html += '</div>';
                    
                    list.innerHTML = html;
                } else if (selectedType.id === 'yoga-pilates') {
                    const pilatesWorkouts = workouts.filter(w => w.id.startsWith('pilates_'));
                    const sundayWorkouts = workouts.filter(w => w.id.startsWith('sunday_'));
                    const yogaWorkouts = workouts.filter(w => w.id.startsWith('yoga_'));
                    
                    html += '<div class="workout-group"><div class="workout-group-title">Pilates</div>';
                    html += pilatesWorkouts.map(w => renderWorkoutCard(w)).join('');
                    html += '</div>';
                    
                    html += '<div class="workout-group"><div class="workout-group-title">Sunday Stretch</div>';
                    html += sundayWorkouts.map(w => renderWorkoutCard(w)).join('');
                    html += '</div>';
                    
                    html += '<div class="workout-group"><div class="workout-group-title">Yoga</div>';
                    html += yogaWorkouts.map(w => renderWorkoutCard(w)).join('');
                    html += '</div>';
                    
                    list.innerHTML = html;
                } else {
                    list.innerHTML = workouts.map(w => renderWorkoutCard(w)).join('');
                }
            }
        }

        function renderWorkoutCard(workout) {
            const last = history.find(h => h.workoutId === workout.id);
            const favStar = isFavorite(workout.id) ? 'active' : 'inactive';
            let lastText = '';
            if (last) lastText = `<small>Last: ${new Date(last.date).toLocaleDateString()}</small>`;
            return `<div class="card" onclick='selectWorkout(${JSON.stringify(workout)})'>
                <span class="favorite-star ${favStar}" onclick='toggleFavorite("${workout.id}", event)'>‚òÖ</span>
                <div class="goal-badge pending">${workout.duration}m</div>
                <h3>${workout.name}</h3>
                <p>${workout.info}</p>
                ${workout.equipment ? `<div class="equipment">Equipment: ${workout.equipment}</div>` : ''}
                ${lastText}
            </div>`;
        }

        function selectWorkout(workout) {
            selectedWorkout = workout;
            openModal();
        }

        function openModal() {
            document.getElementById('logDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('logEquipment').value = selectedWorkout.equipment || '';
            document.getElementById('logNotes').value = '';
            
            let detailsHtml = `<strong>${selectedWorkout.name || 'Session ' + selectedWorkout.session}</strong>`;
            if (selectedWorkout.info) detailsHtml += `<div style="margin-top: 4px;">${selectedWorkout.info}</div>`;
            if (selectedWorkout.notes) detailsHtml += `<div style="margin-top: 4px; color: #059669;">üí° ${selectedWorkout.notes}</div>`;
            
            // Show previous workout history
            const previousLogs = history.filter(h => {
                if (selectedWorkout.session) {
                    return h.type === selectedType.id && h.cycle === selectedCycle && h.session === selectedWorkout.session;
                } else {
                    return h.workoutId === selectedWorkout.id;
                }
            }).slice(0, 3);
            
            if (previousLogs.length > 0) {
                detailsHtml += `<div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e5e7eb;">`;
                detailsHtml += `<div style="font-size: 13px; font-weight: 600; color: #6b7280; margin-bottom: 8px;">Previous times:</div>`;
                previousLogs.forEach(log => {
                    detailsHtml += `<div style="font-size: 12px; color: #374151; margin-bottom: 6px; padding: 6px; background: #f9fafb; border-radius: 4px;">`;
                    detailsHtml += `<div style="font-weight: 500;">${new Date(log.date).toLocaleDateString()}</div>`;
                    if (log.equipment) detailsHtml += `<div style="color: #6b7280; margin-top: 2px;">Equipment: ${log.equipment}</div>`;
                    if (log.notes) detailsHtml += `<div style="color: #6b7280; margin-top: 2px; font-style: italic;">${log.notes}</div>`;
                    detailsHtml += `</div>`;
                });
                detailsHtml += `</div>`;
            }
            
            document.getElementById('workoutDetails').innerHTML = detailsHtml;
            document.getElementById('logModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('logModal').classList.remove('show');
        }

        function saveWorkout() {
            const newLog = {
                id: Date.now(),
                type: selectedType.id,
                typeName: selectedType.name,
                cycle: selectedCycle,
                session: selectedWorkout?.session || null,
                workoutId: selectedWorkout?.id || null,
                workoutName: selectedWorkout?.name || `Cycle ${selectedCycle} Session ${selectedWorkout?.session}`,
                workoutInfo: selectedWorkout?.info || '',
                date: document.getElementById('logDate').value,
                duration: selectedWorkout?.duration || '',
                equipment: document.getElementById('logEquipment').value,
                notes: document.getElementById('logNotes').value
            };
            history.unshift(newLog);
            localStorage.setItem('workoutHistory', JSON.stringify(history));
            closeModal();
            showHome();
        }

        function showHistory() {
            hideAll();
            currentView = 'history';
            document.getElementById('historyView').classList.remove('hidden');
            document.getElementById('homeNavBtn').classList.remove('active');
            document.getElementById('historyNavBtn').classList.add('active');
            
            const list = document.getElementById('historyList');
            if (history.length === 0) {
                list.innerHTML = '<div class="empty-state">No workouts logged yet.<br>Start tracking your progress!</div>';
            } else {
                list.innerHTML = history.map(w => {
                    let metaItems = [];
                    metaItems.push(`üìÖ ${new Date(w.date).toLocaleDateString()}`);
                    if (w.duration) metaItems.push(`‚è±Ô∏è ${w.duration} mins`);
                    if (w.equipment) metaItems.push(`üèãÔ∏è ${w.equipment}`);
                    
                    let notesHtml = '';
                    if (w.notes) notesHtml = `<div class="notes">${w.notes}</div>`;
                    
                    return `<div class="history-card">
                        <h4>${w.workoutName}</h4>
                        ${w.workoutInfo ? `<p style="font-size: 13px; color: #6b7280; margin-bottom: 6px;">${w.workoutInfo}</p>` : ''}
                        <div class="meta">${metaItems.join(' ‚Ä¢ ')}</div>
                        ${notesHtml}
                    </div>`;
                }).join('');
            }
        }

        function goBack() {
            if (currentView === 'sessions') showCycles();
            else if (currentView === 'cycles' || currentView === 'workouts') showHome();
        }

        showHome();
    </script>
</body>
</html>
