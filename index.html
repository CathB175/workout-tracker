<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Workout Tracker</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f9fafb;
        }
        #root {
            width: 100%;
            min-height: 100vh;
        }
        
        /* Fix for iOS Safari modal */
        .modal-overlay {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background-color: rgba(0, 0, 0, 0.7) !important;
            z-index: 99999 !important;
            overflow-y: auto !important;
            -webkit-overflow-scrolling: touch !important;
        }
        
        .modal-content {
            background: white !important;
            margin: 20px auto !important;
            padding: 24px !important;
            border-radius: 12px !important;
            width: 90% !important;
            max-width: 400px !important;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3) !important;
            position: relative !important;
            z-index: 100000 !important;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Calendar, Clock, ChevronRight, Plus, History, Home } = lucide;

        const WorkoutTracker = () => {
            const [view, setView] = useState('home');
            const [selectedType, setSelectedType] = useState(null);
            const [selectedCycle, setSelectedCycle] = useState(null);
            const [selectedWorkout, setSelectedWorkout] = useState(null);
            const [workoutHistory, setWorkoutHistory] = useState([]);
            const [showLogForm, setShowLogForm] = useState(false);

            useEffect(() => {
                const saved = localStorage.getItem('workoutHistory');
                if (saved) setWorkoutHistory(JSON.parse(saved));
            }, []);

            useEffect(() => {
                localStorage.setItem('workoutHistory', JSON.stringify(workoutHistory));
            }, [workoutHistory]);

            const workoutTypes = [
                { id: 'hiit', name: 'HIIT', source: 'The Body Coach', hasCycles: true },
                { id: 'yoga', name: 'Yoga', source: 'The Body Coach', hasCycles: false },
                { id: 'pilates', name: 'Pilates', source: 'The Body Coach', hasCycles: false },
                { id: 'smm', name: 'SMM', source: 'Simple Mobility Method', hasCycles: false },
                { id: 'stability', name: 'Stability Builder', source: 'SMM', hasCycles: false },
                { id: 'spf', name: 'SPF', source: 'Shoulder & Posture Fix', hasCycles: false }
            ];

            const workoutData = {
                hiit: {
                    cycles: [
                        { id: 1, name: 'Cycle 1', sessions: [1, 2, 3, 4, 5] },
                        { id: 2, name: 'Cycle 2', sessions: [1, 2, 3, 4, 5] },
                        { id: 3, name: 'Cycle 3', sessions: [1, 2, 3, 4, 5] }
                    ]
                },
                yoga: [
                    { id: 'morning-flow', name: 'Morning Flow', duration: 20, info: 'Gentle morning sequence', youtubeLink: '' },
                    { id: 'power-yoga', name: 'Power Yoga', duration: 30, info: 'Strength building flow', youtubeLink: '' },
                    { id: 'evening-stretch', name: 'Evening Stretch', duration: 15, info: 'Relaxing wind down', youtubeLink: '' }
                ],
                pilates: [
                    { id: 'core-strength', name: 'Core Strength', duration: 25, info: 'Core focused workout', youtubeLink: '' },
                    { id: 'full-body', name: 'Full Body', duration: 30, info: 'Complete pilates session', youtubeLink: '' }
                ],
                smm: [
                    { id: 'daily-routine', name: 'Daily Routine', duration: 15, info: 'Basic mobility sequence', youtubeLink: '' },
                    { id: 'deep-work', name: 'Deep Work', duration: 30, info: 'Intensive mobility session', youtubeLink: '' }
                ],
                stability: [
                    { id: 'foundation', name: 'Foundation', duration: 20, info: 'Basic stability work', youtubeLink: '' },
                    { id: 'advanced', name: 'Advanced', duration: 25, info: 'Advanced stability exercises', youtubeLink: '' }
                ],
                spf: [
                    { id: 'shoulder-mobility', name: 'Shoulder Mobility', duration: 15, info: 'Shoulder focused work', youtubeLink: '' },
                    { id: 'posture-reset', name: 'Posture Reset', duration: 20, info: 'Posture correction routine', youtubeLink: '' }
                ]
            };

            const getLastWorkout = (type, cycle = null, session = null) => {
                const filtered = workoutHistory.filter(h => {
                    if (h.type !== type) return false;
                    if (cycle && h.cycle !== cycle) return false;
                    if (session && h.session !== session) return false;
                    return true;
                });
                return filtered.sort((a, b) => new Date(b.date) - new Date(a.date))[0];
            };

            const getNextSession = (type) => {
                const lastWorkout = getLastWorkout(type);
                if (!lastWorkout) return { cycle: 1, session: 1 };
                
                if (lastWorkout.session < 5) {
                    return { cycle: lastWorkout.cycle, session: lastWorkout.session + 1 };
                } else if (lastWorkout.cycle < 3) {
                    return { cycle: lastWorkout.cycle + 1, session: 1 };
                }
                return { cycle: 1, session: 1 };
            };

            const logWorkout = (formData) => {
                const newLog = {
                    id: Date.now(),
                    type: selectedType.id,
                    typeName: selectedType.name,
                    cycle: selectedCycle,
                    session: selectedWorkout?.session || null,
                    workoutId: selectedWorkout?.id || null,
                    workoutName: selectedWorkout?.name || `Cycle ${selectedCycle} Session ${selectedWorkout?.session}`,
                    date: formData.date,
                    duration: formData.duration,
                    notes: formData.notes
                };
                setWorkoutHistory([newLog, ...workoutHistory]);
                setShowLogForm(false);
                setView('home');
                setSelectedType(null);
                setSelectedCycle(null);
                setSelectedWorkout(null);
            };

            const LogFormModal = () => {
                const [localDate, setLocalDate] = useState(new Date().toISOString().split('T')[0]);
                const [localDuration, setLocalDuration] = useState('');
                const [localNotes, setLocalNotes] = useState('');

                useEffect(() => {
                    document.body.style.overflow = 'hidden';
                    return () => {
                        document.body.style.overflow = 'unset';
                    };
                }, []);

                const handleSubmit = () => {
                    logWorkout({
                        date: localDate,
                        duration: localDuration,
                        notes: localNotes
                    });
                };

                return (
                    <div className="modal-overlay">
                        <div className="modal-content">
                            <div style={{ marginBottom: '20px', paddingBottom: '15px', borderBottom: '2px solid #e5e7eb' }}>
                                <h3 style={{ fontSize: '24px', fontWeight: 'bold', color: '#111' }}>Log Workout</h3>
                            </div>
                            
                            <div style={{ marginBottom: '20px' }}>
                                <label style={{ display: 'block', fontSize: '15px', fontWeight: '600', color: '#111', marginBottom: '8px' }}>Date</label>
                                <input
                                    type="date"
                                    value={localDate}
                                    onChange={(e) => setLocalDate(e.target.value)}
                                    style={{ width: '100%', padding: '14px', border: '2px solid #ddd', borderRadius: '8px', fontSize: '16px' }}
                                />
                            </div>
                            
                            <div style={{ marginBottom: '20px' }}>
                                <label style={{ display: 'block', fontSize: '15px', fontWeight: '600', color: '#111', marginBottom: '8px' }}>Duration (minutes)</label>
                                <input
                                    type="number"
                                    value={localDuration}
                                    onChange={(e) => setLocalDuration(e.target.value)}
                                    style={{ width: '100%', padding: '14px', border: '2px solid #ddd', borderRadius: '8px', fontSize: '16px' }}
                                    placeholder="20"
                                />
                            </div>
                            
                            <div style={{ marginBottom: '25px' }}>
                                <label style={{ display: 'block', fontSize: '15px', fontWeight: '600', color: '#111', marginBottom: '8px' }}>Notes</label>
                                <textarea
                                    value={localNotes}
                                    onChange={(e) => setLocalNotes(e.target.value)}
                                    style={{ width: '100%', padding: '14px', border: '2px solid #ddd', borderRadius: '8px', fontSize: '16px', minHeight: '100px' }}
                                    placeholder="How did it feel?"
                                />
                            </div>
                            
                            <div style={{ display: 'flex', gap: '12px' }}>
                                <button
                                    onClick={() => setShowLogForm(false)}
                                    style={{ flex: 1, backgroundColor: '#e5e7eb', color: '#111', padding: '16px', borderRadius: '10px', fontWeight: '600', border: 'none', fontSize: '16px', cursor: 'pointer' }}
                                >
                                    Cancel
                                </button>
                                <button
                                    onClick={handleSubmit}
                                    style={{ flex: 1, backgroundColor: '#3b82f6', color: 'white', padding: '16px', borderRadius: '10px', fontWeight: '600', border: 'none', fontSize: '16px', cursor: 'pointer' }}
                                >
                                    Save
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div style={{ minHeight: '100vh', backgroundColor: '#f9fafb' }}>
                    <div style={{ backgroundColor: '#3b82f6', color: 'white', padding: '16px', boxShadow: '0 2px 4px rgba(0,0,0,0.1)' }}>
                        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                            {view !== 'home' && (
                                <button 
                                    onClick={() => {
                                        if (view === 'sessions') setView('cycles');
                                        else if (view === 'cycles' || view === 'workouts') setView('home');
                                        else if (view === 'history') setView('home');
                                    }}
                                    style={{ color: 'white', background: 'none', border: 'none', fontSize: '16px', cursor: 'pointer' }}
                                >
                                    ‚Üê Back
                                </button>
                            )}
                            {view === 'home' && <div></div>}
                            <h1 style={{ fontSize: '20px', fontWeight: 'bold' }}>Workout Tracker</h1>
                            <div></div>
                        </div>
                    </div>

                    <div style={{ paddingBottom: '80px' }}>
                        {view === 'home' && (
                            <div style={{ padding: '24px' }}>
                                <h1 style={{ fontSize: '28px', fontWeight: 'bold', marginBottom: '8px', color: '#1f2937' }}>What do you fancy doing?</h1>
                                <p style={{ color: '#6b7280', marginBottom: '32px' }}>Choose your workout type</p>
                                
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                                    {workoutTypes.map(type => {
                                        const lastWorkout = getLastWorkout(type.id);
                                        const nextSession = type.id === 'hiit' ? getNextSession(type.id) : null;
                                        
                                        return (
                                            <button
                                                key={type.id}
                                                onClick={() => {
                                                    setSelectedType(type);
                                                    setView(type.hasCycles ? 'cycles' : 'workouts');
                                                }}
                                                style={{ width: '100%', backgroundColor: 'white', padding: '16px', borderRadius: '8px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)', border: '2px solid #f3f4f6', cursor: 'pointer', textAlign: 'left' }}
                                            >
                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                    <div>
                                                        <h3 style={{ fontWeight: '600', fontSize: '18px', color: '#1f2937' }}>{type.name}</h3>
                                                        <p style={{ fontSize: '14px', color: '#6b7280' }}>{type.source}</p>
                                                        {lastWorkout && (
                                                            <p style={{ fontSize: '12px', color: '#9ca3af', marginTop: '4px' }}>
                                                                Last: {new Date(lastWorkout.date).toLocaleDateString()}
                                                                {lastWorkout.cycle && ` - Cycle ${lastWorkout.cycle} Session ${lastWorkout.session}`}
                                                            </p>
                                                        )}
                                                        {nextSession && (
                                                            <p style={{ fontSize: '12px', color: '#3b82f6', marginTop: '4px' }}>
                                                                Next: Cycle {nextSession.cycle} Session {nextSession.session}
                                                            </p>
                                                        )}
                                                    </div>
                                                    <ChevronRight color="#9ca3af" size={20} />
                                                </div>
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {view === 'cycles' && (
                            <div style={{ padding: '24px' }}>
                                <h2 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '8px', color: '#1f2937' }}>{selectedType.name}</h2>
                                <p style={{ fontSize: '14px', color: '#6b7280', marginBottom: '24px' }}>
                                    Next up: Cycle {getNextSession(selectedType.id).cycle} Session {getNextSession(selectedType.id).session}
                                </p>
                                
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                                    {workoutData.hiit.cycles.map(cycle => {
                                        const lastInCycle = getLastWorkout(selectedType.id, cycle.id);
                                        
                                        return (
                                            <button
                                                key={cycle.id}
                                                onClick={() => {
                                                    setSelectedCycle(cycle.id);
                                                    setView('sessions');
                                                }}
                                                style={{ width: '100%', backgroundColor: 'white', padding: '16px', borderRadius: '8px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)', border: '2px solid #f3f4f6', cursor: 'pointer', textAlign: 'left' }}
                                            >
                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                    <div>
                                                        <h3 style={{ fontWeight: '600', fontSize: '18px', color: '#1f2937' }}>{cycle.name}</h3>
                                                        <p style={{ fontSize: '14px', color: '#6b7280' }}>5 sessions</p>
                                                        {lastInCycle && (
                                                            <p style={{ fontSize: '12px', color: '#9ca3af', marginTop: '4px' }}>
                                                                Last: Session {lastInCycle.session} - {new Date(lastInCycle.date).toLocaleDateString()}
                                                            </p>
                                                        )}
                                                    </div>
                                                    <ChevronRight color="#9ca3af" size={20} />
                                                </div>
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {view === 'sessions' && (
                            <div style={{ padding: '24px' }}>
                                <h2 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '8px', color: '#1f2937' }}>Cycle {selectedCycle}</h2>
                                <p style={{ fontSize: '14px', color: '#6b7280', marginBottom: '24px' }}>Choose a session</p>
                                
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                                    {workoutData.hiit.cycles.find(c => c.id === selectedCycle).sessions.map(session => {
                                        const lastCompleted = getLastWorkout(selectedType.id, selectedCycle, session);
                                        
                                        return (
                                            <button
                                                key={session}
                                                onClick={() => {
                                                    setSelectedWorkout({ session });
                                                    setShowLogForm(true);
                                                }}
                                                style={{ width: '100%', backgroundColor: 'white', padding: '16px', borderRadius: '8px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)', border: '2px solid #f3f4f6', cursor: 'pointer', textAlign: 'left' }}
                                            >
                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                    <div>
                                                        <h3 style={{ fontWeight: '600', fontSize: '18px', color: '#1f2937' }}>Session {session}</h3>
                                                        {lastCompleted && (
                                                            <p style={{ fontSize: '12px', color: '#9ca3af', marginTop: '4px' }}>
                                                                Last completed: {new Date(lastCompleted.date).toLocaleDateString()}
                                                                {lastCompleted.duration && ` - ${lastCompleted.duration} mins`}
                                                            </p>
                                                        )}
                                                    </div>
                                                    <Plus color="#3b82f6" size={20} />
                                                </div>
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {view === 'workouts' && (
                            <div style={{ padding: '24px' }}>
                                <h2 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '24px', color: '#1f2937' }}>{selectedType.name}</h2>
                                
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                                    {workoutData[selectedType.id].map(workout => {
                                        const lastCompleted = workoutHistory.find(h => h.workoutId === workout.id);
                                        
                                        return (
                                            <button
                                                key={workout.id}
                                                onClick={() => {
                                                    setSelectedWorkout(workout);
                                                    setShowLogForm(true);
                                                }}
                                                style={{ width: '100%', backgroundColor: 'white', padding: '16px', borderRadius: '8px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)', border: '2px solid #f3f4f6', cursor: 'pointer', textAlign: 'left' }}
                                            >
                                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                                    <div style={{ flex: 1 }}>
                                                        <h3 style={{ fontWeight: '600', fontSize: '18px', color: '#1f2937' }}>{workout.name}</h3>
                                                        <p style={{ fontSize: '14px', color: '#6b7280' }}>{workout.info}</p>
                                                        <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginTop: '8px', fontSize: '12px', color: '#6b7280' }}>
                                                            <span style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>
                                                                <Clock size={12} /> {workout.duration} mins
                                                            </span>
                                                            {lastCompleted && (
                                                                <span style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>
                                                                    <Calendar size={12} /> Last: {new Date(lastCompleted.date).toLocaleDateString()}
                                                                </span>
                                                            )}
                                                        </div>
                                                    </div>
                                                    <Plus color="#3b82f6" size={20} />
                                                </div>
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {view === 'history' && (
                            <div style={{ padding: '24px' }}>
                                <h2 style={{ fontSize: '24px', fontWeight: 'bold', marginBottom: '24px', color: '#1f2937' }}>Workout History</h2>
                                
                                {workoutHistory.length === 0 ? (
                                    <p style={{ color: '#6b7280', textAlign: 'center', marginTop: '32px' }}>No workouts logged yet</p>
                                ) : (
                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                                        {workoutHistory.map(workout => (
                                            <div key={workout.id} style={{ backgroundColor: 'white', padding: '16px', borderRadius: '8px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)', border: '2px solid #f3f4f6' }}>
                                                <h3 style={{ fontWeight: '600', color: '#1f2937' }}>{workout.typeName}</h3>
                                                <p style={{ fontSize: '14px', color: '#6b7280' }}>{workout.workoutName}</p>
                                                <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginTop: '8px', fontSize: '12px', color: '#6b7280' }}>
                                                    <span style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>
                                                        <Calendar size={12} /> {new Date(workout.date).toLocaleDateString()}
                                                    </span>
                                                    {workout.duration && (
                                                        <span style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>
                                                            <Clock size={12} /> {workout.duration} mins
                                                        </span>
                                                    )}
                                                </div>
                                                {workout.notes && (
                                                    <p style={{ fontSize: '14px', color: '#6b7280', marginTop: '8px', fontStyle: 'italic' }}>{workout.notes}</p>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </div>

                    <div style={{ position: 'fixed', bottom: 0, left: 0, right: 0, backgroundColor: 'white', borderTop: '1px solid #e5e7eb', display: 'flex' }}>
                        <button
                            onClick={() => {
                                setView('home');
                                setSelectedType(null);
                                setSelectedCycle(null);
                                setSelectedWorkout(null);
                            }}
                            style={{ flex: 1, padding: '16px 0', display: 'flex', flexDirection: 'column', alignItems: 'center', background: 'none', border: 'none', cursor: 'pointer', color: view === 'home' ? '#3b82f6' : '#9ca3af' }}
                        >
                            <Home size={24} />
                            <span style={{ fontSize: '12px', marginTop: '4px' }}>Home</span>
                        </button>
                        <button
                            onClick={() => setView('history')}
                            style={{ flex: 1, padding: '16px 0', display: 'flex', flexDirection: 'column', alignItems: 'center', background: 'none', border: 'none', cursor: 'pointer', color: view === 'history' ? '#3b82f6' : '#9ca3af' }}
                        >
                            <History size={24} />
                            <span style={{ fontSize: '12px', marginTop: '4px' }}>History</span>
                        </button>
                    </div>

                    {showLogForm && <LogFormModal />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<WorkoutTracker />);
    </script>
</body>
</html>