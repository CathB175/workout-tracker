<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #f9fafb; }
        .header { background: #3b82f6; color: white; padding: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header h1 { font-size: 20px; text-align: center; }
        .back-btn { background: none; border: none; color: white; font-size: 16px; cursor: pointer; float: left; }
        .container { padding: 24px 24px 100px 24px; }
        .title { font-size: 28px; font-weight: bold; margin-bottom: 8px; }
        .subtitle { color: #6b7280; margin-bottom: 32px; }
        .card { background: white; padding: 16px; border-radius: 8px; border: 2px solid #f3f4f6; margin-bottom: 12px; cursor: pointer; }
        .card:active { background: #f9fafb; }
        .card h3 { font-weight: 600; font-size: 18px; margin-bottom: 4px; }
        .card p { font-size: 14px; color: #6b7280; }
        .card small { font-size: 12px; color: #9ca3af; display: block; margin-top: 4px; }
        .nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #e5e7eb; display: flex; }
        .nav button { flex: 1; padding: 16px; background: none; border: none; color: #9ca3af; font-size: 12px; cursor: pointer; }
        .nav button.active { color: #3b82f6; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.75); padding: 20px; overflow-y: auto; z-index: 9999; }
        .modal.show { display: block; }
        .modal-content { background: white; margin: 20px auto; padding: 24px; border-radius: 12px; max-width: 400px; }
        .modal h3 { font-size: 22px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #eee; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 6px; font-size: 14px; }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; font-family: inherit; }
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        .btn { flex: 1; padding: 14px; border: none; border-radius: 8px; font-weight: 600; font-size: 16px; cursor: pointer; }
        .btn-cancel { background: #e5e7eb; color: #111; }
        .btn-save { background: #3b82f6; color: white; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="header">
        <button class="back-btn hidden" id="backBtn" onclick="goBack()">‚Üê Back</button>
        <h1>Workout Tracker</h1>
    </div>

    <div class="container" id="homeView">
        <h1 class="title">What do you fancy doing?</h1>
        <p class="subtitle">Choose your workout type</p>
        <div id="typesList"></div>
    </div>

    <div class="container hidden" id="cyclesView">
        <h2 class="title" id="cyclesTitle"></h2>
        <p class="subtitle" id="cyclesSubtitle"></p>
        <div id="cyclesList"></div>
    </div>

    <div class="container hidden" id="sessionsView">
        <h2 class="title" id="sessionsTitle"></h2>
        <p class="subtitle">Choose a session</p>
        <div id="sessionsList"></div>
    </div>

    <div class="container hidden" id="workoutsView">
        <h2 class="title" id="workoutsTitle"></h2>
        <div id="workoutsList"></div>
    </div>

    <div class="container hidden" id="historyView">
        <h2 class="title">Workout History</h2>
        <div id="historyList"></div>
    </div>

    <div class="modal" id="logModal">
        <div class="modal-content">
            <h3>Log Workout</h3>
            <div class="form-group">
                <label>Date</label>
                <input type="date" id="logDate">
            </div>
            <div class="form-group">
                <label>Duration (minutes)</label>
                <input type="number" id="logDuration" placeholder="20">
            </div>
            <div class="form-group">
                <label>Notes</label>
                <textarea id="logNotes" rows="3" placeholder="How did it feel?"></textarea>
            </div>
            <div class="btn-group">
                <button class="btn btn-cancel" onclick="closeModal()">Cancel</button>
                <button class="btn btn-save" onclick="saveWorkout()">Save</button>
            </div>
        </div>
    </div>

    <div class="nav">
        <button id="homeNavBtn" class="active" onclick="showHome()">
            <div>üè†</div>
            Home
        </button>
        <button id="historyNavBtn" onclick="showHistory()">
            <div>üìã</div>
            History
        </button>
    </div>

    <script>
        let currentView = 'home';
        let selectedType = null;
        let selectedCycle = null;
        let selectedWorkout = null;
        let history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');

        const types = [
            { id: 'hiit', name: 'HIIT', source: 'The Body Coach', hasCycles: true },
            { id: 'yoga', name: 'Yoga', source: 'The Body Coach' },
            { id: 'pilates', name: 'Pilates', source: 'The Body Coach' },
            { id: 'smm', name: 'SMM', source: 'Simple Mobility Method' },
            { id: 'stability', name: 'Stability Builder', source: 'SMM' },
            { id: 'spf', name: 'SPF', source: 'Shoulder & Posture Fix' }
        ];

        const data = {
            hiit: { cycles: [
                { id: 1, name: 'Cycle 1', sessions: [1,2,3,4,5] },
                { id: 2, name: 'Cycle 2', sessions: [1,2,3,4,5] },
                { id: 3, name: 'Cycle 3', sessions: [1,2,3,4,5] }
            ]},
            yoga: [
                { id: 'morning-flow', name: 'Morning Flow', duration: 20, info: 'Gentle morning sequence' },
                { id: 'power-yoga', name: 'Power Yoga', duration: 30, info: 'Strength building flow' },
                { id: 'evening-stretch', name: 'Evening Stretch', duration: 15, info: 'Relaxing wind down' }
            ],
            pilates: [
                { id: 'core', name: 'Core Strength', duration: 25, info: 'Core focused' },
                { id: 'full', name: 'Full Body', duration: 30, info: 'Complete session' }
            ],
            smm: [
                { id: 'daily', name: 'Daily Routine', duration: 15, info: 'Basic mobility' },
                { id: 'deep', name: 'Deep Work', duration: 30, info: 'Intensive session' }
            ],
            stability: [
                { id: 'foundation', name: 'Foundation', duration: 20, info: 'Basic stability' },
                { id: 'advanced', name: 'Advanced', duration: 25, info: 'Advanced exercises' }
            ],
            spf: [
                { id: 'shoulder', name: 'Shoulder Mobility', duration: 15, info: 'Shoulder work' },
                { id: 'posture', name: 'Posture Reset', duration: 20, info: 'Posture correction' }
            ]
        };

        function getLast(type, cycle = null, session = null) {
            return history.filter(h => {
                if (h.type !== type) return false;
                if (cycle && h.cycle !== cycle) return false;
                if (session && h.session !== session) return false;
                return true;
            }).sort((a,b) => new Date(b.date) - new Date(a.date))[0];
        }

        function getNext(type) {
            const last = getLast(type);
            if (!last) return { cycle: 1, session: 1 };
            if (last.session < 5) return { cycle: last.cycle, session: last.session + 1 };
            if (last.cycle < 3) return { cycle: last.cycle + 1, session: 1 };
            return { cycle: 1, session: 1 };
        }

        function hideAll() {
            document.querySelectorAll('.container').forEach(el => el.classList.add('hidden'));
            document.getElementById('backBtn').classList.add('hidden');
        }

        function showHome() {
            hideAll();
            currentView = 'home';
            document.getElementById('homeView').classList.remove('hidden');
            document.getElementById('homeNavBtn').classList.add('active');
            document.getElementById('historyNavBtn').classList.remove('active');
            renderTypes();
        }

        function renderTypes() {
            const list = document.getElementById('typesList');
            list.innerHTML = types.map(type => {
                const last = getLast(type.id);
                const next = type.id === 'hiit' ? getNext(type.id) : null;
                let lastText = '';
                if (last) {
                    lastText = `<small>Last: ${new Date(last.date).toLocaleDateString()}`;
                    if (last.cycle) lastText += ` - Cycle ${last.cycle} Session ${last.session}`;
                    lastText += '</small>';
                }
                let nextText = '';
                if (next) nextText = `<small style="color: #3b82f6;">Next: Cycle ${next.cycle} Session ${next.session}</small>`;
                return `<div class="card" onclick="selectType('${type.id}')">
                    <h3>${type.name}</h3>
                    <p>${type.source}</p>
                    ${lastText}${nextText}
                </div>`;
            }).join('');
        }

        function selectType(typeId) {
            selectedType = types.find(t => t.id === typeId);
            if (selectedType.hasCycles) {
                showCycles();
            } else {
                showWorkouts();
            }
        }

        function showCycles() {
            hideAll();
            currentView = 'cycles';
            document.getElementById('cyclesView').classList.remove('hidden');
            document.getElementById('backBtn').classList.remove('hidden');
            const next = getNext(selectedType.id);
            document.getElementById('cyclesTitle').textContent = selectedType.name;
            document.getElementById('cyclesSubtitle').textContent = `Next up: Cycle ${next.cycle} Session ${next.session}`;
            
            const list = document.getElementById('cyclesList');
            list.innerHTML = data.hiit.cycles.map(cycle => {
                const last = getLast(selectedType.id, cycle.id);
                let lastText = '';
                if (last) lastText = `<small>Last: Session ${last.session} - ${new Date(last.date).toLocaleDateString()}</small>`;
                return `<div class="card" onclick="selectCycle(${cycle.id})">
                    <h3>${cycle.name}</h3>
                    <p>5 sessions</p>
                    ${lastText}
                </div>`;
            }).join('');
        }

        function selectCycle(cycleId) {
            selectedCycle = cycleId;
            showSessions();
        }

        function showSessions() {
            hideAll();
            currentView = 'sessions';
            document.getElementById('sessionsView').classList.remove('hidden');
            document.getElementById('backBtn').classList.remove('hidden');
            document.getElementById('sessionsTitle').textContent = `Cycle ${selectedCycle}`;
            
            const list = document.getElementById('sessionsList');
            const sessions = data.hiit.cycles.find(c => c.id === selectedCycle).sessions;
            list.innerHTML = sessions.map(session => {
                const last = getLast(selectedType.id, selectedCycle, session);
                let lastText = '';
                if (last) {
                    lastText = `<small>Last: ${new Date(last.date).toLocaleDateString()}`;
                    if (last.duration) lastText += ` - ${last.duration} mins`;
                    lastText += '</small>';
                }
                return `<div class="card" onclick="selectSession(${session})">
                    <h3>Session ${session}</h3>
                    ${lastText}
                </div>`;
            }).join('');
        }

        function selectSession(session) {
            selectedWorkout = { session };
            openModal();
        }

        function showWorkouts() {
            hideAll();
            currentView = 'workouts';
            document.getElementById('workoutsView').classList.remove('hidden');
            document.getElementById('backBtn').classList.remove('hidden');
            document.getElementById('workoutsTitle').textContent = selectedType.name;
            
            const list = document.getElementById('workoutsList');
            list.innerHTML = data[selectedType.id].map(workout => {
                const last = history.find(h => h.workoutId === workout.id);
                let lastText = '';
                if (last) lastText = `<small>Last: ${new Date(last.date).toLocaleDateString()}</small>`;
                return `<div class="card" onclick='selectWorkout(${JSON.stringify(workout)})'>
                    <h3>${workout.name}</h3>
                    <p>${workout.info} ‚Ä¢ ${workout.duration} mins</p>
                    ${lastText}
                </div>`;
            }).join('');
        }

        function selectWorkout(workout) {
            selectedWorkout = workout;
            openModal();
        }

        function openModal() {
            document.getElementById('logDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('logDuration').value = '';
            document.getElementById('logNotes').value = '';
            document.getElementById('logModal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('logModal').classList.remove('show');
        }

        function saveWorkout() {
            const newLog = {
                id: Date.now(),
                type: selectedType.id,
                typeName: selectedType.name,
                cycle: selectedCycle,
                session: selectedWorkout?.session || null,
                workoutId: selectedWorkout?.id || null,
                workoutName: selectedWorkout?.name || `Cycle ${selectedCycle} Session ${selectedWorkout?.session}`,
                date: document.getElementById('logDate').value,
                duration: document.getElementById('logDuration').value,
                notes: document.getElementById('logNotes').value
            };
            history.unshift(newLog);
            localStorage.setItem('workoutHistory', JSON.stringify(history));
            closeModal();
            showHome();
        }

        function showHistory() {
            hideAll();
            currentView = 'history';
            document.getElementById('historyView').classList.remove('hidden');
            document.getElementById('homeNavBtn').classList.remove('active');
            document.getElementById('historyNavBtn').classList.add('active');
            
            const list = document.getElementById('historyList');
            if (history.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #6b7280; margin-top: 32px;">No workouts logged yet</p>';
            } else {
                list.innerHTML = history.map(w => {
                    let durationText = w.duration ? `<small>‚è±Ô∏è ${w.duration} mins</small>` : '';
                    let notesText = w.notes ? `<p style="font-style: italic; margin-top: 8px; color: #6b7280;">${w.notes}</p>` : '';
                    return `<div class="card">
                        <h3>${w.typeName}</h3>
                        <p>${w.workoutName}</p>
                        <small>üìÖ ${new Date(w.date).toLocaleDateString()}</small>
                        ${durationText}
                        ${notesText}
                    </div>`;
                }).join('');
            }
        }

        function goBack() {
            if (currentView === 'sessions') showCycles();
            else if (currentView === 'cycles' || currentView === 'workouts') showHome();
        }

        showHome();
    </script>
</body>
</html>
